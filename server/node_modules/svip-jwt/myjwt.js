const crypto = require("crypto");
const jwt = {
    encodeBase64(str){
        return Buffer.from(str).toString("base64");
    },
    decodeBase64(str){
        return Buffer.from(str,"base64").toString();
    },
    //编码
    encode(payload,secret){//header.payload.sign
        let header = {"typ": "JWT","alg": "HS256"};
        let headerBase64 = this.encodeBase64(JSON.stringify(header));
        let payloadBase64 = this.encodeBase64(JSON.stringify(payload));

        let sign = this.sign([headerBase64,payloadBase64].join("."),secret);
        return [headerBase64,payloadBase64,sign].join(".");
    },
    //解码
    decode(token,secret){//token:header.payload.secret
        let [header,payload,sign] = token.split(".");

        return JSON.parse(this.decodeBase64(payload));

    },
    sign(str,secret){
        return crypto.createHmac('sha256', secret).update(str).digest('base64');
    }

}
module.exports = jwt;
// let payload = {username:"aaa"};
// let secret = "secret";

// let token = jwt.encode(payload,secret);

// console.log(token);

// payload = jwt.decode(token,secret);
// console.log(payload);




